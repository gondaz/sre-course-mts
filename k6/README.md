# K6

Скрипт хранится в диретории urls/mts\
Профиль нагрузки хранится в директории ammo (они же "патроны")

Приложение "api" нагружается профилем в виде GET запросов по различным ендпоинтам в случайном порядке. \
Прерывание тестирования установлено при невыполнении условия по времени ответа > 6s (99p), либо один из реквестов упадет по таймауту > 30s. \
SLO  в данном случае: время ответа не выше 6s по 99p\
Цель НТ: выяснить максимально возможный RPS при следующих условия сервиса api: limits: 250m(cpu)/128Mi(ram), replicas: 2\
Тестирование проводится с ВМ внутри MTS Cloud (8 vCPU, 16GB RAM) для исключения проблем сетевой связности от локальной машины пользователя

В результате тестирования тест прервался преждевременно при достижении RPS 1460, далее произошел отвал реквеста по таймауту на один запросов (>30s), хотя среднее время ответа по 99p от сервиса оставалось в пределах SLO\
Лог k6 приведен ниже:

````
     █ setup

     data_received..............: 51 MB   117 kB/s
     data_sent..................: 68 MB   155 kB/s
     http_req_blocked...........: avg=52.57µs min=1.4µs    med=2.78µs  max=23.44ms p(90)=3.79µs  p(95)=4.72µs  p(99)=3.49ms 
     http_req_connecting........: avg=48.38µs min=0s       med=0s      max=23.31ms p(90)=0s      p(95)=0s      p(99)=3.4ms  
   ✗ http_req_duration..........: avg=2.33ms  min=847.57µs med=2.12ms  max=57.31ms p(90)=2.93ms  p(95)=3.23ms  p(99)=6.61ms 
     http_req_failed............: 100.00% ✓ 246430     ✗ 0     
     http_req_receiving.........: avg=40.92µs min=5.5µs    med=24.27µs max=31.54ms p(90)=50.6µs  p(95)=79.04µs p(99)=506.1µs
     http_req_sending...........: avg=19.62µs min=6.06µs   med=17.25µs max=2.41ms  p(90)=24.85µs p(95)=32.7µs  p(99)=74.01µs
     http_req_tls_handshaking...: avg=0s      min=0s       med=0s      max=0s      p(90)=0s      p(95)=0s      p(99)=0s     
     http_req_waiting...........: avg=2.27ms  min=806.63µs med=2.06ms  max=57.28ms p(90)=2.86ms  p(95)=3.15ms  p(99)=6.54ms 
     http_reqs..................: 246430  565.635317/s
     iteration_duration.........: avg=2.55ms  min=76.51µs  med=2.28ms  max=57.5ms  p(90)=3.15ms  p(95)=3.53ms  p(99)=8.29ms 
     iterations.................: 246430  565.635317/s
     vus........................: 3       min=0        max=5   
     vus_max....................: 3000    min=3000     max=3000

running (7m15.7s), 0000/3000 VUs, 246430 complete and 4 interrupted iterations
contacts ✗ [=================================>----] 0003/3000 VUs  7m15.7s/8m0s  1630.10 iters/s
ERRO[0438] thresholds on metrics 'http_req_duration' were crossed; at least one has abortOnFail enabled, stopping test prematurely
````

Вероятно узкие места:
1. Нехватка ресурсов подов сервиса, поды подходят к границе лимитов по ЦПУ при максимальном RPS
2. Неоптимизированный код самого приложения api, возможно требуется перестроить логику обращения к БД

Приложены скриншоты графика RPS ingress и нагрузки на поды перед падением НТ

В рамках задачи не предполагалcя поиск и решение проблем приложения, а лишь проведение НТ и выяснение максимальной производительности